<!doctype html>




<html class="theme-next pisces" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="docker," />





  <link rel="alternate" href="/atom.xml" title="J_drops" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Docker简介什么是容器？
一种虚拟化的方案
操作系统级别的虚拟化
只能运行相同或相似内核的操作系统
依赖于Linux内核特性:Namespace和Cgroup(Control Group)
什么是Docker?
将应用程序自动部署到容器的开源引擎
Go语言开源引擎  Github地址： [](https://github.com/docker/docker)
基于Apache 2.0开源授权协">
<meta property="og:type" content="article">
<meta property="og:title" content="docker学习">
<meta property="og:url" content="http://yoursite.com/2016/11/10/docker学习/index.html">
<meta property="og:site_name" content="J_drops">
<meta property="og:description" content="Docker简介什么是容器？
一种虚拟化的方案
操作系统级别的虚拟化
只能运行相同或相似内核的操作系统
依赖于Linux内核特性:Namespace和Cgroup(Control Group)
什么是Docker?
将应用程序自动部署到容器的开源引擎
Go语言开源引擎  Github地址： [](https://github.com/docker/docker)
基于Apache 2.0开源授权协">
<meta property="og:image" content="http://yotuku.cn/link?url=EyDp5bTlM&tk_plan=free&tk_storage=tietuku&tk_vuid=2176a6e5-d922-47e9-80d7-c5a752db4ad7&tk_time=2016111015">
<meta property="og:image" content="http://yotuku.cn/link?url=E1d-1fTlz&tk_plan=free&tk_storage=tietuku&tk_vuid=2176a6e5-d922-47e9-80d7-c5a752db4ad7&tk_time=2016111015">
<meta property="og:image" content="http://yotuku.cn/link?url=B1HpSFr-l&tk_plan=free&tk_storage=tietuku&tk_vuid=2176a6e5-d922-47e9-80d7-c5a752db4ad7&tk_time=2016111314">
<meta property="og:updated_time" content="2016-12-04T15:07:47.212Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="docker学习">
<meta name="twitter:description" content="Docker简介什么是容器？
一种虚拟化的方案
操作系统级别的虚拟化
只能运行相同或相似内核的操作系统
依赖于Linux内核特性:Namespace和Cgroup(Control Group)
什么是Docker?
将应用程序自动部署到容器的开源引擎
Go语言开源引擎  Github地址： [](https://github.com/docker/docker)
基于Apache 2.0开源授权协">
<meta name="twitter:image" content="http://yotuku.cn/link?url=EyDp5bTlM&tk_plan=free&tk_storage=tietuku&tk_vuid=2176a6e5-d922-47e9-80d7-c5a752db4ad7&tk_time=2016111015">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2016/11/10/docker学习/"/>





  <title> docker学习 | J_drops </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">J_drops</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人生没有白走的路，每一步都算数</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/10/docker学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jdrops">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://i4.buimg.com/567571/7a862ab5af458319.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="J_drops">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                docker学习
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-10T14:49:34+08:00">
                2016-11-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Docker简介"><a href="#Docker简介" class="headerlink" title="Docker简介"></a>Docker简介</h3><p>什么是容器？</p>
<pre><code>一种虚拟化的方案
操作系统级别的虚拟化
只能运行相同或相似内核的操作系统
依赖于Linux内核特性:Namespace和Cgroup(Control Group)
</code></pre><p><img src="http://yotuku.cn/link?url=EyDp5bTlM&amp;tk_plan=free&amp;tk_storage=tietuku&amp;tk_vuid=2176a6e5-d922-47e9-80d7-c5a752db4ad7&amp;tk_time=2016111015" alt=""><br>什么是Docker?</p>
<pre><code>将应用程序自动部署到容器的开源引擎
Go语言开源引擎  Github地址： [](https://github.com/docker/docker)
基于Apache 2.0开源授权协议发行
</code></pre><a id="more"></a>
<p>Docker的特点？</p>
<pre><code>提供简单轻量的建模方式
职责的逻辑分离
快速搞笑的开发生命周期
鼓励使用面向服务的架构
</code></pre><p>Docker的使用场景</p>
<pre><code>1 使用Docker容器开发，测试，部署服务
2 创建隔离的运行环境
3 搭建测试环境
4 构建多用户的平台即服务基础设施
5 提供软件即服务应用程序
6 高性能，多规模的宿主机部署
</code></pre><p>Docker的基本组成</p>
<pre><code>Docker Client客户端；Daemon守护进程；Image镜像；Container容器;Registry仓库
</code></pre><h4 id="Docker客户端-守护进程"><a href="#Docker客户端-守护进程" class="headerlink" title="Docker客户端/守护进程"></a>Docker客户端/守护进程</h4><pre><code> C/S架构
本地/远程
</code></pre><p><img src="http://yotuku.cn/link?url=E1d-1fTlz&amp;tk_plan=free&amp;tk_storage=tietuku&amp;tk_vuid=2176a6e5-d922-47e9-80d7-c5a752db4ad7&amp;tk_time=2016111015" alt=""></p>
<h4 id="Docker-Image镜像"><a href="#Docker-Image镜像" class="headerlink" title="Docker Image镜像"></a>Docker Image镜像</h4><pre><code>容器的基石（容器基于镜像启动和运行，镜像就好比容器的的源代码，保存了启动容器的各种条件）
层叠的只读文件系统 bootfs(引导文件系统）当容器启动后将被移到内存中，而引导文件系统将会被卸载;
联合加载（union mount)
</code></pre><h3 id="容器的基本操作"><a href="#容器的基本操作" class="headerlink" title="容器的基本操作"></a>容器的基本操作</h3><p>交互式容器在命令结束后，就停止</p>
<p>启动容器：</p>
<pre><code>$docker run IMAGE [COMMAND][ARG...]
run  在新容器中执行命令
执行单次命令的容器:
ubuntu@ubuntu:~$ docker run ubuntu echo &apos;Hello world&apos;
Hello world

启动交互式容器：
$docker run -i -t IMAGE /bin/bash
    -i --interactive=ture|fasle 默认是false  交互
    -t --tty=true|false 默认是false
ubuntu@ubuntu:~$ docker run -i -t ubuntu /bin/bash
root@44d36a84c016:/# ps -ef
UID         PID   PPID  C STIME TTY          TIME CMD
root          1      0  0 03:48 ?        00:00:00 /bin/bash
root         12      1  0 03:49 ?        00:00:00 ps -ef
root@44d36a84c016:/# ls
bin   dev  home  lib64  mnt  proc  run   srv  tmp  var
boot  etc  lib   media  opt  root  sbin  sys  usr
root@44d36a84c016:/# exit
exit
</code></pre><p>查看容器</p>
<pre><code>$docker ps [-a][-l]
    -a 列出所有的容器
    -l 列出最新创建的容器

CONTAINEG ID docker的守护进程，当启动时为容器分配的唯一ID
NAMES    docker守护进程启动时为容器自动分配的名字

ubuntu@ubuntu:~$ docker ps -l
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES
44d36a84c016        ubuntu:latest       &quot;/bin/bash&quot;         7 minutes ago       Exited (0) 6 minutes ago                       gloomy_bohr  
</code></pre><p>如何查看刚刚创建的容器</p>
<pre><code>$docker inspect 参数：容器的名字（ID或友好的名字)
ubuntu@ubuntu:~$ docker inspect 44d36a84c016
[{
&quot;AppArmorProfile&quot;: &quot;&quot;,
&quot;Args&quot;: [],
&quot;Config&quot;: {
    &quot;AttachStderr&quot;: true,
    &quot;AttachStdin&quot;: true,
    &quot;AttachStdout&quot;: true,
    &quot;Cmd&quot;: [
        &quot;/bin/bash&quot;
    ],
    &quot;CpuShares&quot;: 0,
      ........
</code></pre><p>自定义容器名</p>
<pre><code>$docker run --name=自定义名 -i -t IMAGE /bin/bash

ubuntu@ubuntu:~$ docker run --name=container01 -i -t ubuntu /bin/bash
root@89fdd67fcc7c:/# exit
exit
ubuntu@ubuntu:~$ docker inspect container01 
</code></pre><p>重新启动停止的容器</p>
<pre><code>$docker start [-i] 容器名

ubuntu@ubuntu:~$ docker start -i container01 
root@89fdd67fcc7c:/# exit
exit
</code></pre><p>删除停止的容器（只能删除停止的容器)</p>
<pre><code>$docker rm 容器名

ubuntu@ubuntu:~$ docker rm a14eae563c17
a14eae563c17
</code></pre><h3 id="守护式容器"><a href="#守护式容器" class="headerlink" title="守护式容器"></a>守护式容器</h3><p>守护式容器，长期运行，没有交互式的会话，适合运行应用程序和服务</p>
<p>以守护形式运行容器</p>
<pre><code>$docker run -i -t IMAGE /bin/bash
Ctrl+P + Ctrl+Q  将一个交互式的容器转到后台

ubuntu@ubuntu:~$ docker run -i -t ubuntu /bin/bash
root@7a5baebf940a:/# 
root@7a5baebf940a:/# ubuntu@ubuntu:~$ 
ubuntu@ubuntu:~$ docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
7a5baebf940a        ubuntu:latest       &quot;/bin/bash&quot;         3 minutes ago       Up 3 minutes                            dreamy_hopper   
</code></pre><p>附加到运行中的容器</p>
<pre><code>$docker attach 容器名

ubuntu@ubuntu:~$ docker attach 7a

root@7a5baebf940a:/# ubuntu@ubuntu:~$ 
ubuntu@ubuntu:~$ docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
7a5baebf940a        ubuntu:latest       &quot;/bin/bash&quot;         7 minutes ago       Up 7 minutes                            dreamy_hopper       
ubuntu@ubuntu:~$ docker attach 7a

root@7a5baebf940a:/# exit
exit
ubuntu@ubuntu:~$ docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES  
</code></pre><p>启动守护式容器</p>
<pre><code>$docker run 镜像名 [COMMAND] [ARG...]
    -d 告诉run命令在启动容器时使用后台的方式来执行命令

ubuntu@ubuntu:~$ docker run --name dc3 -d ubuntu /bin/sh -c &quot;while true;do echo hello world;sleep 1;done&quot;
29de71a93dfaf67cb27b6fa5d953ecd6ca924e6b1923a31d6f41995af268af24
ubuntu@ubuntu:~$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS               NAMES
29de71a93dfa        ubuntu:latest       &quot;/bin/sh -c &apos;while t   4 seconds ago       Up 3 seconds                            dc3        
</code></pre><p>查看容器日志</p>
<pre><code>$docker logs [-f][-t][--tail] 容器名
    -f --follows=true|false 默认为false 会一直跟踪日志变化，并返回结果
    -t --timestamps=true|false 默认为false
    --tail=&quot;all&quot;  返回结尾处多少数量的日志

ubuntu@ubuntu:~$ docker logs -t -f --tail 10 dc3
2016-11-13T04:52:46.493926964Z hello world
2016-11-13T04:52:47.495737431Z hello world
2016-11-13T04:52:48.497870319Z hello world
2016-11-13T04:52:49.499945897Z hello world
2016-11-13T04:52:50.501718368Z hello world
2016-11-13T04:52:51.503647625Z hello world .....
</code></pre><p>查看容器内进程</p>
<pre><code>$docker top 容器名

Cubuntu@ubuntu:~$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS               NAMES
29de71a93dfa        ubuntu:latest       &quot;/bin/sh -c &apos;while t   4 minutes ago       Up 4 minutes                            dc3                 
ubuntu@ubuntu:~$ docker top dc3
UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD
root                69209               66638               0                   20:51               ?                   00:00:00            /bin/sh -c while true;do echo hello world;sleep 1;done
root                69613               69209               0                   20:56               ?                   00:00:00            sleep 1
</code></pre><p>为运行中的容器启动新进程（对运行中的容器维护监控或执行一些管理任务）</p>
<pre><code>$docker exec [-d][-i][-t] 容器名 [COMMAND][ARG..]

ubuntu@ubuntu:~$ docker exec -i -t dc3 /bin/bash
root@29de71a93dfa:/# ubuntu@ubuntu:~$ 
ubuntu@ubuntu:~$ docker top dc3
UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD
root                69209               66638               0                   20:51               ?                   00:00:00            /bin/sh -c while true;do echo hello world;sleep 1;done
root                69914               66638               0                   21:01               pts/1               00:00:00            /bin/bash
root                69963               69209               0                   21:01               ?                   00:00:00            sleep 1
</code></pre><p>如何停止运行中的容器：</p>
<pre><code>$docker stop 容器名 发送一个信号给容器，并等待容器的停止
$docker kill 容器名  会立刻停止容器

ubuntu@ubuntu:~$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS               NAMES
29de71a93dfa        ubuntu:latest       &quot;/bin/sh -c &apos;while t   14 minutes ago      Up 14 minutes                           dc3                 
ubuntu@ubuntu:~$ docker stop dc3
dc3
</code></pre><h3 id="使用Docker帮助文件"><a href="#使用Docker帮助文件" class="headerlink" title="使用Docker帮助文件"></a>使用Docker帮助文件</h3><pre><code>man docker-run
man docker-logs
man docker-top
man docker-exec
...
</code></pre><h3 id="在容器中部署静态网站"><a href="#在容器中部署静态网站" class="headerlink" title="在容器中部署静态网站"></a>在容器中部署静态网站</h3><p>设置容器的端口映射</p>
<p>设置容器的端口映射</p>
<pre><code>run [-P][-p]
    -P,--publish-all=ture|false默认为false
将为容器暴露的所有端口进行映射
docker run -P -i -t ubuntu /bin/bash 
    -p,--publish=[]  
containerPort 只指定容器的端口，宿主机端口随机映射
  docker run -p 80 -i -t ubuntu /bin/bash
hostPort:containerPort 同时指定宿主机端口和容器端口
  docker run -p 8080:80 -i -t ubuntu /bin/bash
ip::containerPort  指定ip和容器的端口
  docker run -p 0.0.0.0:80 -i -t ubuntu /bin/bash
ip:hostPort:containerPort 同时指定ip,宿主机和容器的端口
  docker run -p 0.0.0.0:8080:80 -i -t ubuntu /bin/bash
</code></pre><p>Nginx部署流程</p>
<ul>
<li>创建映射80端口的交互式容器</li>
<li>安装Nginx</li>
<li>安装文本编辑器vim</li>
<li>创建静态页面</li>
<li>修改Nginx配置文件</li>
<li>运行Nginx</li>
<li>验证网站访问</li>
</ul>
<p>-</p>
<pre><code>ubuntu@ubuntu:~$ docker run -p 80 --name web -i -t ubuntu /bin/bash
root@3fdfe785153a:/# apt-get update 
root@3fdfe785153a:/# apt-get install -y nginx
root@3fdfe785153a:/# apt-get install -y
root@3fdfe785153a:/# mkdir -p /var/www/html
root@3fdfe785153a:/# cd /var/www/html 
root@3fdfe785153a:/var/www/html# vim index.html

&lt;html&gt;
&lt;head&gt;
        &lt;title&gt;Nginx in Docker&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
        &lt;h1&gt;Hello,I&apos;m website in Docker!&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;

root@3fdfe785153a:/var/www/html# whereis nginx
nginx: /usr/sbin/nginx /etc/nginx /usr/share/nginx
root@3fdfe785153a:/var/www/html# ls
index.html  index.nginx-debian.html
root@3fdfe785153a:/var/www/html# ls /etc/nginx 
conf.d        fastcgi_params  koi-win     nginx.conf    scgi_params      sites-enabled  uwsgi_params
fastcgi.conf  koi-utf         mime.types  proxy_params  sites-available  snippets       win-utf
root@3fdfe785153a:/var/www/html# ls /etc/nginx/sites-enabled 
default
root@3fdfe785153a:/var/www/html# vim /etc/nginx/sites-enabled/default 
root@3fdfe785153a:/var/www/html# cd /
root@3fdfe785153a:/# nginx
root@3fdfe785153a:/# ps -ef
UID         PID   PPID  C STIME TTY          TIME CMD
root          1      0  0 05:36 ?        00:00:00 /bin/bash
root        816      1  0 06:12 ?        00:00:00 nginx: master process nginx
www-data    817    816  0 06:12 ?        00:00:00 nginx: worker process
www-data    818    816  0 06:12 ?        00:00:00 nginx: worker process
www-data    819    816  0 06:12 ?        00:00:00 nginx: worker process
www-data    820    816  0 06:12 ?        00:00:00 nginx: worker process
root        821      1  0 06:12 ?        00:00:00 ps -ef
root@3fdfe785153a:/# ubuntu@ubuntu:~$ 
ubuntu@ubuntu:~$ docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                   NAMES
3fdfe785153a        ubuntu:latest       &quot;/bin/bash&quot;         37 minutes ago      Up 37 minutes       0.0.0.0:32768-&gt;80/tcp   web                 
ubuntu@ubuntu:~$ docker port web
80/tcp -&gt; 0.0.0.0:32768
ubuntu@ubuntu:~$ docker top web
UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD
root                70403               66638               0                   21:36               pts/1               00:00:00            /bin/bash
root                71341               70403               0                   22:12               ?                   00:00:00            nginx: master process nginx
www-data            71342               71341               0                   22:12               ?                   00:00:00            nginx: worker process
www-data            71343               71341               0                   22:12               ?                   00:00:00            nginx: worker process
www-data            71344               71341               0                   22:12               ?                   00:00:00            nginx: worker process
www-data            71345               71341               0                   22:12               ?                   00:00:00            nginx: worker process
ubuntu@ubuntu:~$ curl http://127.0.0.1:32768
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Nginx in Docker&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Hello,I&apos;m website in Docker!&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p><img src="http://yotuku.cn/link?url=B1HpSFr-l&amp;tk_plan=free&amp;tk_storage=tietuku&amp;tk_vuid=2176a6e5-d922-47e9-80d7-c5a752db4ad7&amp;tk_time=2016111314" alt=""></p>
<pre><code>上面使用的是宿主主机地址，现在使用容器的地址
ubuntu@ubuntu:~$ docker inspect web

&quot;Gateway&quot;: &quot;172.17.42.1&quot;

ubuntu@ubuntu:~$ curl http://172.17.0.10
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Nginx in Docker&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Hello,I&apos;m website in Docker!&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;

stop后重新启动访问

ubuntu@ubuntu:~$ docker stop web
web
ubuntu@ubuntu:~$ docker start -i web
root@3fdfe785153a:/# ps -ef
UID         PID   PPID  C STIME TTY          TIME CMD
root          1      0  0 06:25 ?        00:00:00 /bin/bash
root         11      1  0 06:27 ?        00:00:00 ps -ef
root@3fdfe785153a:/# ubuntu@ubuntu:~$ 
ubuntu@ubuntu:~$ docker exec web nginx
ubuntu@ubuntu:~$ docker top web
UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD
root                71751               66638               0                   22:25               pts/1               00:00:00            /bin/bash
root                71809               71751               0                   22:28               ?                   00:00:00            nginx: master process nginx
www-data            71810               71809               0                   22:28               ?                   00:00:00            nginx: worker process
www-data            71811               71809               0                   22:28               ?                   00:00:00            nginx: worker process
www-data            71812               71809               0                   22:28               ?                   00:00:00            nginx: worker process
www-data            71813               71809               0                   22:28               ?                   00:00:00            nginx: worker process
</code></pre><p>当停止一个容器并且重新访问时，原来容器的ip地址和端口都将会发生变化</p>
<pre><code>ubuntu@ubuntu:~$ curl http://172.17.0.10
curl: (7) Failed to connect to 172.17.0.10 port 80: No route to host
ubuntu@ubuntu:~$ docker inspect web
.....
  &quot;MountLabel&quot;: &quot;&quot;,
    &quot;Name&quot;: &quot;/web&quot;,
    &quot;NetworkSettings&quot;: {
        &quot;Bridge&quot;: &quot;docker0&quot;,
        &quot;Gateway&quot;: &quot;172.17.42.1&quot;,
        &quot;GlobalIPv6Address&quot;: &quot;&quot;,
        &quot;GlobalIPv6PrefixLen&quot;: 0,
        &quot;IPAddress&quot;: &quot;172.17.0.11&quot;,
        &quot;IPPrefixLen&quot;: 16,
        &quot;IPv6Gateway&quot;: &quot;&quot;,
        &quot;LinkLocalIPv6Address&quot;: &quot;fe80::42:acff:fe11:b&quot;,
        &quot;LinkLocalIPv6PrefixLen&quot;: 64,
        &quot;MacAddress&quot;: &quot;02:42:ac:11:00:0b&quot;,
        &quot;PortMapping&quot;: null,
        &quot;Ports&quot;: {
            &quot;80/tcp&quot;: [
                {
                    &quot;HostIp&quot;: &quot;0.0.0.0&quot;,
                    &quot;HostPort&quot;: &quot;32769&quot;
                }
....
ubuntu@ubuntu:~$ curl http://172.17.0.11
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Nginx in Docker&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Hello,I&apos;m website in Docker!&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="查看和删除镜像"><a href="#查看和删除镜像" class="headerlink" title="查看和删除镜像"></a>查看和删除镜像</h3><p>镜像的存储地址</p>
<ul>
<li>/var/lib/docker</li>
</ul>
<p>-</p>
<pre><code>ubuntu@ubuntu:~$ docker info
Containers: 11
Images: 94
Storage Driver: aufs
 Root Dir: /var/lib/docker/aufs
 Backing Filesystem: extfs
 Dirs: 116
 Dirperm1 Supported: true
Execution Driver: native-0.2
Kernel Version: 4.2.0-16-generic
Operating System: Ubuntu 15.10
CPUs: 4
Total Memory: 1.533 GiB
Name: ubuntu
ID: AL2G:N2BW:2DGD:DBKV:GV77:ESDE:5BIG:BOYM:25H2:MHLX:KJK3:VNBF
WARNING: No swap limit support
ubuntu@ubuntu:~$ ls -l /var/lib/docker/aufs
ls: cannot access /var/lib/docker/aufs: Permission denied
ubuntu@ubuntu:~$ sudo ls -l /var/lib/docker/aufs
[sudo] password for ubuntu: 
total 48
drwxr-xr-x 118 root root 16384 Nov 12 21:36 diff
drwxr-xr-x   2 root root 16384 Nov 12 21:36 layers
drwxr-xr-x 118 root root 16384 Nov 12 21:36 mnt
</code></pre><h4 id="列出镜像"><a href="#列出镜像" class="headerlink" title="列出镜像"></a>列出镜像</h4><pre><code>$docker images [OPTSIUNS][REPOSITORY]
   -a,--all=false
   -f,--filter=[]  显示时的过滤条件
   --no-trunc=false  指定不使用截断的方式
   -q,--quiet=false
</code></pre><h4 id="查看镜像"><a href="#查看镜像" class="headerlink" title="查看镜像"></a>查看镜像</h4><pre><code>$docker inspect [OPTIONS]CONTAINER|IMAGE[CONTAINER|IMAGE...]
   -f,--format=&quot;&quot;

ubuntu@ubuntu:~$ docker inspect ubuntu:latest 
</code></pre><h4 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h4><pre><code>$docker rmi [OPTIONS]IMAGE[IMAGE...]
   -f,--force=false 
   --no-prune=false Do not delete untagged parents

ubuntu:~$ docker rmi wordpress:4.6.1 
</code></pre><h3 id="获取和推送镜像"><a href="#获取和推送镜像" class="headerlink" title="获取和推送镜像"></a>获取和推送镜像</h3><h4 id="查找镜像"><a href="#查找镜像" class="headerlink" title="查找镜像"></a>查找镜像</h4><ul>
<li>Docker Hub</li>
</ul>
<p><a href="https://registry.hub.docker.com" target="_blank" rel="external"></a></p>
<ul>
<li><p>$docker search [OPTIONS]TERM</p>
<pre><code>--automated=false Only show automated builds 自动化选项
--no-trunc=false Don&apos;t truncate output 
-s,--stars=0  Only displays with at least x start 星级
最多返回25个结果
ubuntu@ubuntu:~$ docker search -s 3 ubuntu
NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
ubuntu                            Ubuntu is a Debian-based Linux operating s...   5033      [OK]       
ubuntu-upstart                    Upstart is an event-based replacement for ...   68        [OK]       
rastasheep/ubuntu-sshd            Dockerized SSH service, built on top of of...   49                   [OK]
consol/ubuntu-xfce-vnc            Ubuntu container with &quot;headless&quot; VNC sessi...   29                   [OK]
ubuntu-debootstrap                debootstrap --variant=minbase --components...   27        [OK]       
torusware/speedus-ubuntu          Always updated official Ubuntu docker imag...   27                   [OK]
ioft/armhf-ubuntu                 [ABR] Ubuntu Docker images for the ARMv7(a...   19                   [OK]
nuagebec/ubuntu                   Simple always updated Ubuntu docker images...   10                   [OK]
nickistre/ubuntu-lamp             LAMP server on Ubuntu                           10                   [OK]
nickistre/ubuntu-lamp-wordpress   LAMP on Ubuntu with wp-cli installed            7                    [OK]
nimmis/ubuntu                     This is a docker images different LTS vers...   5                    [OK]
</code></pre><h4 id="拉取镜像（需要下载到本地"><a href="#拉取镜像（需要下载到本地" class="headerlink" title="拉取镜像（需要下载到本地)"></a>拉取镜像（需要下载到本地)</h4><p>  $docker pull [options] name [:tag]<br>   -a,–all-tags=false<br>  ubuntu@ubuntu:~$ docker pull ubuntu:14.04</p>
<p>   14.04: Pulling from ubuntu<br>  e7176b79954f: Pull complete<br>  e359a53f3a8b: Pull complete<br>  4655efdd3550: Already exists<br>  4d0b81bdf94e: Already exists<br>  82b16b694f1b: Already exists<br>  879409173f70: Already exists<br>  Digest: sha256:bae6d9e8c91f31a11d324495efb3859fce873de1e9db990a62d16e4f263f5a2e<br>  Status: Downloaded newer image for ubuntu:14.04</p>
</li>
</ul>
<h4 id="拉取镜像-加速访问）"><a href="#拉取镜像-加速访问）" class="headerlink" title="拉取镜像(加速访问）"></a>拉取镜像(加速访问）</h4><pre><code>使用--registry-mirror 选项
 1.修改 ： /etc/default/docker
 2.添加：DOCKER_OPTS = &quot;--registry-mirror=http://MIRROR-ADDR&quot;
</code></pre><h4 id="推送镜像"><a href="#推送镜像" class="headerlink" title="推送镜像"></a>推送镜像</h4><pre><code>$docker push NAME:[:TAG]
</code></pre><h3 id="构建docker镜像"><a href="#构建docker镜像" class="headerlink" title="构建docker镜像"></a>构建docker镜像</h3><ul>
<li>1.保存对容器的修改，并再次使用；</li>
<li>2.自定义镜像的能力;</li>
<li><p>3.以软件的形式打包并分发服务及其运行环境</p>
<h4 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h4><p>  $docker commit  通过容器构建<br>  $docker commit [OPTION] CONTAINEG [REPOSITORY[:TAG]]</p>
<pre><code>-a,--author=&quot;&quot;  作者
-m,--message=&quot;&quot; Commit message  构建信息
-p,--pause=true Pause container during commit  指示不暂停正在运行的容器
</code></pre><p>  ubuntu@ubuntu:~$ docker commit -a “jdrops520” -m ‘nginx’ web jdrops520/commit_web1</p>
<p>  bc4ef9f3e881bd1034dc2dbca62f053044f5ac77696d3bc67e69e749fa1331e7<br>  ubuntu@ubuntu:~$<br>  ubuntu@ubuntu:~$ docker images<br>  REPOSITORY              TAG                 IMAGE ID            CREATED              VIRTUAL SIZE<br>  jdrops520/commit_web1   latest              bc4ef9f3e881        37 seconds ago       275.8 MB<br>  <none>                  <none>              7a32cf0408fa        3 weeks ago          160.5 MB<br>  ubuntu                  latest              56465e1e45d2        4 weeks ago          127.2 MB<br>  ubuntu                  14.04               e359a53f3a8b        4 weeks ago          187.9 MB<br>  <none>                  <none>              04b555fcaf13        9 weeks ago          341.8 MB<br>  <none>                  <none>              07a3e6032afb        3 months ago         188 MB<br>  hello-world             latest              f0cb9bdcaa69        4 months ago         1.848 kB<br>  ubuntu                  12.10               c5881f11ded9        2.406760 years ago   172.1 MB<br>  ubuntu@ubuntu:~$ docker run -d –name nginx_web1 jdrops520/commit_web1 nginx -g “daemon off;”<br>  35423f6554dc8cddc95dd88f924e9ab091ae330094e9aa7ba159c1d11e68019a<br>  ubuntu@ubuntu:~$ docker ps<br>  CONTAINER ID        IMAGE                          COMMAND                CREATED             STATUS              PORTS                   NAMES<br>  35423f6554dc        jdrops520/commit_web1:latest   “nginx -g ‘daemon of   17 seconds ago      Up 16 seconds       80/tcp                  nginx_web1<br>  3fdfe785153a        ubuntu:latest                  “/bin/bash”            3 hours ago         Up 2 hours          0.0.0.0:32769-&gt;80/tcp   web<br>  ubuntu@ubuntu:~$ curl <a href="http://127.0.0.1:32769" target="_blank" rel="external">http://127.0.0.1:32769</a><br>  <html><br>  <head></head></html></none></none></none></none></none></none></p>
<pre><code>&lt;title&gt;Nginx in Docker&lt;/title&gt;
</code></pre><p>  <br>  <body></body></p>
<pre><code>&lt;h1&gt;Hello,I&apos;m website in Docker!&lt;/h1&gt;
</code></pre><p>  <br>  <br>使用Dockerfile创建镜像<br>创建第一个Dockerfile       </p>
<p>  $docker build   通过Dockerfile文件构建<br>  $docker build [OPTIONS]PATH |URL|-</p>
<pre><code>--force-rm=false
--no-cache=false
--pull=false
-q,--quiet=false
--rm=ture
-t,--tag=&quot;&quot; 指定构建出的镜像的名字
</code></pre></li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>
    <div>
      
          
<div style="text-align:center;color: #ccc;font-size:14px;">
------*** end*** ------</div>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/docker/" rel="tag"># docker</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/10/29/全局防护Bypass之宽字节注入/" rel="next" title="全局防护Bypass之宽字节注入">
                <i class="fa fa-chevron-left"></i> 全局防护Bypass之宽字节注入
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/11/15/渗透绕WAF的方法/" rel="prev" title="渗透绕WAF的方法">
                渗透绕WAF的方法 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://i4.buimg.com/567571/7a862ab5af458319.jpg"
               alt="Jdrops" />
          <p class="site-author-name" itemprop="name">Jdrops</p>
           
              <p class="site-description motion-element" itemprop="description">天下事有难易乎？为之，则难者亦易矣；不为，则易者亦难矣。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                    <span class="links-of-author-item" style="text-align:left">
                       <a href="https://z.codes/" title="python大神" target="_blank">
                           python大神
                      </a>
                    </span>
                 
                    <span class="links-of-author-item" style="text-align:left">
                       <a href="http://blog.neargle.com/" title="斌师傅" target="_blank">
                           斌师傅
                      </a>
                    </span>
                 
                    <span class="links-of-author-item" style="text-align:left">
                       <a href="http://byd.dropsec.xyz/" title="毕师傅" target="_blank">
                           毕师傅
                      </a>
                    </span>
                 
                    <span class="links-of-author-item" style="text-align:left">
                       <a href="http://zjw.dropsec.xyz/" title="hello_c" target="_blank">
                           hello_c
                      </a>
                    </span>
                 
                    <span class="links-of-author-item" style="text-align:left">
                       <a href="http://zt.dropsec.xyz/" title="小光头" target="_blank">
                           小光头
                      </a>
                    </span>
                 
                    <span class="links-of-author-item" style="text-align:left">
                       <a href="http://lzx.dropsec.xyz/" title="George_Lee" target="_blank">
                           George_Lee
                      </a>
                    </span>
                 
                    <span class="links-of-author-item" style="text-align:left">
                       <a href="https://klionsec.github.io" title="klion" target="_blank">
                           klion
                      </a>
                    </span>
                 
                    <span class="links-of-author-item" style="text-align:left">
                       <a href="http://www.myh0st.cn/" title="信安之路" target="_blank">
                           信安之路
                      </a>
                    </span>
                 
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker简介"><span class="nav-number">1.</span> <span class="nav-text">Docker简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Docker客户端-守护进程"><span class="nav-number">1.1.</span> <span class="nav-text">Docker客户端/守护进程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Docker-Image镜像"><span class="nav-number">1.2.</span> <span class="nav-text">Docker Image镜像</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#容器的基本操作"><span class="nav-number">2.</span> <span class="nav-text">容器的基本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#守护式容器"><span class="nav-number">3.</span> <span class="nav-text">守护式容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Docker帮助文件"><span class="nav-number">4.</span> <span class="nav-text">使用Docker帮助文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在容器中部署静态网站"><span class="nav-number">5.</span> <span class="nav-text">在容器中部署静态网站</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看和删除镜像"><span class="nav-number">6.</span> <span class="nav-text">查看和删除镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#列出镜像"><span class="nav-number">6.1.</span> <span class="nav-text">列出镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看镜像"><span class="nav-number">6.2.</span> <span class="nav-text">查看镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#删除镜像"><span class="nav-number">6.3.</span> <span class="nav-text">删除镜像</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取和推送镜像"><span class="nav-number">7.</span> <span class="nav-text">获取和推送镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#查找镜像"><span class="nav-number">7.1.</span> <span class="nav-text">查找镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#拉取镜像（需要下载到本地"><span class="nav-number">7.2.</span> <span class="nav-text">拉取镜像（需要下载到本地)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#拉取镜像-加速访问）"><span class="nav-number">7.3.</span> <span class="nav-text">拉取镜像(加速访问）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#推送镜像"><span class="nav-number">7.4.</span> <span class="nav-text">推送镜像</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#构建docker镜像"><span class="nav-number">8.</span> <span class="nav-text">构建docker镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#构建镜像"><span class="nav-number">8.1.</span> <span class="nav-text">构建镜像</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jdrops</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  

  

</body>
</html>
